<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detalle de Factura #{{ invoice.id }}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-dark text-white min-vh-100">
    <header class="bg-dark border-bottom border-primary py-3 shadow">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <h1 class="text-white mb-0 fw-bold">
              <a
                href="{{ url_for('auth.dashboard') }}"
                style="color: white; text-decoration: none"
              >
                <i class="fas fa-chart-line me-3 text-primary"></i>
                Sistema de Facturación
              </a>
            </h1>
          </div>
        </div>
      </div>
    </header>

    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          {% if error %}
          <div class="alert alert-danger mb-4" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
          </div>
          {% endif %}

          <div
            class="card bg-dark border-secondary shadow-lg"
            style="border-radius: 12px"
          >
            <div
              class="card-header bg-dark border-secondary d-flex justify-content-between align-items-center"
            >
              <h2 class="text-white mb-0">
                <i class="fas fa-file-invoice me-2"></i>Factura #{{ invoice.id
                }}
              </h2>
            </div>
            <div class="card-body">
              <div class="row mb-4">
                <div class="col-md-6">
                  <div class="card bg-white border-0 h-100">
                    <div class="card-body">
                      <h5 class="card-title text-primary">
                        <i class="fas fa-user me-2"></i>Información del Cliente
                      </h5>
                      <p class="card-text mb-1">
                        <strong>Nombre:</strong> {{ invoice.client.name if
                        invoice.client else 'Cliente no encontrado' }}
                      </p>
                      {% if invoice.client and invoice.client.email %}
                      <p class="card-text mb-1">
                        <strong>Email:</strong> {{ invoice.client.email }}
                      </p>
                      {% endif %} {% if invoice.client and invoice.client.phone
                      %}
                      <p class="card-text mb-0">
                        <strong>Teléfono:</strong> {{ invoice.client.phone }}
                      </p>
                      {% endif %}
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card bg-white border-0 h-100">
                    <div class="card-body">
                      <h5 class="card-title text-primary">
                        <i class="fas fa-calendar me-2"></i>Información de la
                        Factura
                      </h5>
                      <p class="card-text mb-1">
                        <strong>Número:</strong> #{{ invoice.id }}
                      </p>
                      <p class="card-text mb-1">
                        <strong>Fecha:</strong> {{
                        invoice.date.strftime('%d/%m/%Y') }}
                      </p>
                      <p class="card-text mb-0">
                        <strong>Estado:</strong>
                        <span class="badge bg-success">Activa</span>
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="card bg-white border-0 mb-4">
                <div class="card-header bg-white">
                  <h5 class="mb-0 text-primary">
                    <i class="fas fa-list me-2"></i>Productos y Servicios
                  </h5>
                </div>
                <div class="card-body">
                  {% if details %}
                  <div class="table-responsive">
                    <table class="table table-dark table-hover">
                      <thead class="table-primary">
                        <tr>
                          <th scope="col">Producto/Servicio</th>
                          <th scope="col" class="text-center">Cantidad</th>
                          <th scope="col" class="text-end">Precio Unitario</th>
                          <th scope="col" class="text-end">Subtotal</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for detail in details %}
                        <tr>
                          <td>
                            <div>
                              <strong
                                >{{ detail.product.description if detail.product
                                else 'Producto eliminado' }}</strong
                              >
                              {% if detail.product and detail.product.code %}
                              <br /><small class="text-muted"
                                >Código: {{ detail.product.code }}</small
                              >
                              {% endif %}
                            </div>
                          </td>
                          <td class="text-center">{{ detail.quantity }}</td>
                          <td class="text-end">
                            ${{ "%.2f"|format(detail.unit_price) }}
                          </td>
                          <td class="text-end">
                            <strong
                              >${{ "%.2f"|format(detail.subtotal) }}</strong
                            >
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  {% else %}
                  <div class="text-center py-4">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <p class="text-muted">
                      No hay productos agregados a esta factura
                    </p>
                  </div>
                  {% endif %}
                </div>
              </div>

              <div class="row">
                <div class="col-md-8"></div>
                <div class="col-md-4">
                  <div class="card bg-primary border-0">
                    <div class="card-body text-center">
                      <h4 class="card-title mb-2">
                        <i class="fas fa-calculator me-2"></i>Total
                      </h4>
                      <h2 class="card-text mb-0 fw-bold">
                        ${{ "%.2f"|format(invoice.total or 0) }}
                      </h2>
                    </div>
                  </div>
                </div>
              </div>

              <div class="d-flex justify-content-between mt-4">
                <a
                  href="{{ url_for('invoice.list') }}"
                  class="btn btn-secondary"
                >
                  <i class="fas fa-arrow-left me-2"></i>Volver a la Lista
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
      @media print {
        .btn,
        .btn-group,
        header {
          display: none !important;
        }
        .card {
          border: 1px solid #000 !important;
          box-shadow: none !important;
        }
        body {
          background: white !important;
          color: black !important;
        }
        .bg-dark,
        .bg-secondary,
        .bg-primary {
          background: white !important;
          color: black !important;
        }
        .text-white,
        .text-primary {
          color: black !important;
        }
      }
    </style>
  </body>
</html>
